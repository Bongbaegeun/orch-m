SELECT host, key_, clock, value_int
FROM 
(
SELECT item.host, item.key_, hist.itemid, max(clock) as clock, max(value) as value_int
FROM history hist, (
SELECT itemid, key_, i.hostid, host
FROM items i, hosts h
WHERE i.hostid=h.hostid
AND h.host = 'UBUNTU18.OB1'
AND key_ in (
'8.linux.net.Status[enp3s0f0]'
,'9.linux.process.Service[znmsc]'
,'11.UTM.vnet.ConnTrack'
,'64.UTM.daemon.Status[vpn]'
,'8.linux.process.Process[onebox-agent]'
,'9.linux.process.Process[python ./obord.py]'
,'11.UTM.vcpu.Util'
,'89.linux.net.Tx_Rate[eth5]'
,'89.linux.net.Tx_Rate[eth6]'
,'89.linux.process.Service[onebox-agent]'
,'66.linux.temperature.SVR'
,'66.linux.process.Service[onebox-agent]'
,'66.linux.net.Status[eth2]'
,'89.linux.net.Tx_Rate[eth0]'
,'11.UTM.vnet.Rx_Rate[eth3]'
,'11.UTM.vnet.Rx_Rate[eth4]'
,'9.linux.net.Rx_Rate[eth2]'
,'9.linux.process.Process[/usr/sbin/mysqld]'
,'90.UTM.vnet.Tx_Rate[eth0]'
,'8.linux.process.Service[zabbix-agent]'
,'90.UTM.vnet.Tx_Rate[eth1]'
,'66.linux.process.Service[glance-api]'
,'64.UTM.vnet.Rx_Rate[eth1]'
,'net.tcp.service[tcp,,10050]'
,'9.linux.net.Tx_Rate[eth5]'
,'90.UTM.vnet.ConnTrack'
,'66.linux.net.Tx_Rate[eth5]'
,'8.linux.net.Tx_Rate[enp3s0f0]'
,'89.linux.net.Status[eth4]'
,'9.linux.net.Rx_Rate[eth6]'
,'90.UTM.vnet.Tx_Rate[eth4]'
,'66.linux.cpu.Util'
,'9.linux.process.Service[zabbix-agent]'
,'9.linux.net.Rx_Rate[eth3]'
,'66.linux.net.Status[eth0]'
,'9.linux.process.Service[nova-api]'
,'66.linux.net.Status[eth3]'
,'11.UTM.vmem.Util'
,'9.linux.process.Service[onebox-vnfm]'
,'8.linux.process.Service[httpd]'
,'8.linux.temperature.SVR'
,'9.linux.process.Service[glance-api]'
,'9.linux.net.Status[eth1]'
,'9.linux.net.Tx_Rate[eth4]'
,'90.UTM.vnet.Rx_Rate[eth6]'
,'64.UTM.vnet.VPN_ActiveTunnel'
,'9.linux.net.Rx_Rate[eth5]'
,'66.linux.net.Rx_Rate[eth5]'
,'66.linux.fs.Util[/]'
,'66.linux.process.Service[apache2]'
,'8.linux.process.Service[postgresql-9.3]'
,'66.linux.net.Rx_Rate[eth4]'
,'89.linux.fs.Util[/mnt/flash/data]'
,'64.UTM.vnet.Tx_Rate[eth3]'
,'90.UTM.vnet.VPN_TotalTunnel'
,'9.linux.mem.Util'
,'9.linux.cpu.Util'
,'89.linux.net.Rx_Rate[eth6]'
,'9.linux.process.Process[python orchm.py]'
,'11.UTM.vnet.Tx_Rate[eth4]'
,'90.UTM.vmem.Util'
,'64.UTM.vnet.VPNCount'
,'89.linux.net.Status[eth6]'
,'64.UTM.vnet.ConnTrack'
,'89.linux.net.Status[eth5]'
,'icmpping[]'
,'9.linux.process.Service[neutron-server]'
,'9.linux.net.Rx_Rate[eth4]'
,'66.linux.mem.Util'
,'66.linux.net.Tx_Rate[eth0]'
,'8.linux.mem.Util'
,'90.UTM.vnet.VPN_ActiveTunnel'
,'90.UTM.vdisk.Util'
,'66.linux.net.Tx_Rate[eth3]'
,'64.UTM.vmem.Util'
,'89.linux.cpu.Util'
,'90.UTM.daemon.Status[vpn]'
,'9.linux.net.Status[eth2]'
,'64.UTM.vnet.VPN_TotalTunnel'
,'89.linux.net.Status[eth1]'
,'90.UTM.vnet.Rx_Rate[eth2]'
,'9.linux.process.Process[MCSAgent]'
,'64.UTM.vnet.Tx_Rate[eth2]'
,'90.UTM.vnet.Tx_Rate[eth3]'
,'9.linux.temperature.SVR'
,'66.linux.process.Service[zabbix-agent]'
,'item.inact'
,'89.linux.net.Rx_Rate[eth5]'
,'90.UTM.vnet.Rx_Rate[eth3]'
,'9.linux.net.Tx_Rate[eth6]'
,'89.linux.net.Rx_Rate[eth2]'
,'89.linux.net.Rx_Rate[eth4]'
,'9.linux.net.Tx_Rate[eth0]'
,'11.UTM.vnet.Rx_Rate[eth1]'
,'icmpping[]'
,'90.UTM.vnet.Rx_Rate[eth0]'
,'9.linux.net.Rx_Rate[eth0]'
,'66.linux.process.Process[rabbitmq-server]'
,'9.linux.process.Process[ZabbixAPIGateway.jar]'
,'9.linux.fs.Util[/]'
,'89.linux.net.Rx_Rate[eth0]'
,'66.linux.net.Status[eth5]'
,'9.linux.net.Tx_Rate[eth7]'
,'9.linux.net.Status[eth3]'
,'66.linux.net.Status[eth4]'
,'9.linux.process.Process[rabbitmq-server]'
,'89.linux.net.Status[eth0]'
,'66.linux.process.Service[neutron-server]'
,'89.linux.net.Tx_Rate[eth1]'
,'8.linux.process.Service[zabbix-server]'
,'8.linux.net.Rx_Rate[enp3s0f0]'
,'90.UTM.vcpu.Util'
,'66.linux.process.Service[nova-api]'
,'66.linux.net.Rx_Rate[eth2]'
,'9.linux.net.Rx_Rate[eth1]'
,'64.UTM.vnet.Tx_Rate[eth1]'
,'64.UTM.vnet.Rx_Rate[eth2]'
,'66.linux.net.Tx_Rate[eth4]'
,'66.linux.net.Rx_Rate[eth3]'
,'9.linux.net.Tx_Rate[eth3]'
,'89.linux.net.Status[eth2]'
,'9.linux.net.Status[eth6]'
,'89.linux.net.Tx_Rate[eth3]'
,'90.UTM.vnet.VPNCount'
,'90.UTM.vnet.Rx_Rate[eth1]'
,'9.linux.net.Status[eth0]'
,'net.tcp.service[tcp,,10050]'
,'66.linux.process.Service[znmsc]'
,'8.linux.fs.Util[/]'
,'90.UTM.vnet.Rx_Rate[eth4]'
,'9.linux.net.Status[eth7]'
,'89.linux.net.Rx_Rate[eth3]'
,'8.linux.cpu.Util'
,'11.UTM.daemon.Status[vpn]'
,'9.linux.process.Process[tomcat]'
,'90.UTM.vnet.Rx_Rate[eth5]'
,'90.UTM.vnet.Tx_Rate[eth6]'
,'9.linux.net.Tx_Rate[eth1]'
,'89.linux.temperature.SVR'
,'9.linux.net.Status[eth5]'
,'9.linux.net.Tx_Rate[eth2]'
,'90.UTM.vnet.Tx_Rate[eth5]'
,'9.linux.process.Service[onebox-agent]'
,'11.UTM.vnet.Rx_Rate[eth2]'
,'64.UTM.vnet.Rx_Rate[eth3]'
,'90.UTM.vnet.Tx_Rate[eth2]'
,'66.linux.process.Process[/usr/sbin/mysqld]'
,'89.linux.process.Service[zabbix_agentd]'
,'89.linux.net.Status[eth3]'
,'64.UTM.vdisk.Util'
,'64.UTM.license.Status'
,'11.UTM.vdisk.Util'
,'89.linux.net.Tx_Rate[eth2]'
,'89.linux.net.Tx_Rate[eth4]'
,'89.linux.net.Rx_Rate[eth1]'
,'11.UTM.vnet.Tx_Rate[eth3]'
,'9.linux.net.Status[eth4]'
,'9.linux.net.Rx_Rate[eth7]'
,'11.UTM.vnet.Tx_Rate[eth1]'
,'9.linux.process.Service[mysql]'
,'9.linux.process.Service[postgresql]'
,'89.linux.mem.Util'
,'89.linux.process.Service[znmsc]'
,'66.linux.net.Rx_Rate[eth0]'
,'9.linux.process.Service[apache2]'
,'66.linux.process.Service[onebox-vnfm]'
,'11.UTM.vnet.Tx_Rate[eth2]'
,'64.UTM.vcpu.Util'
,'66.linux.net.Tx_Rate[eth2]')		
		) item
WHERE hist.itemid=item.itemid 
AND hist.clock > 1623117660
GROUP BY item.host, item.key_, hist.itemid

UNION ALL


SELECT item.host, item.key_, hist.itemid, max(clock) as clock, max(value) as value_int
FROM history_uint hist, (
SELECT itemid, key_, i.hostid, host
FROM items i, hosts h
WHERE i.hostid=h.hostid
AND h.host = 'UBUNTU18.OB1'
AND key_ in (
'8.linux.net.Status[enp3s0f0]'
,'9.linux.process.Service[znmsc]'
,'11.UTM.vnet.ConnTrack'
,'64.UTM.daemon.Status[vpn]'
,'8.linux.process.Process[onebox-agent]'
,'9.linux.process.Process[python ./obord.py]'
,'11.UTM.vcpu.Util'
,'89.linux.net.Tx_Rate[eth5]'
,'89.linux.net.Tx_Rate[eth6]'
,'89.linux.process.Service[onebox-agent]'
,'66.linux.temperature.SVR'
,'66.linux.process.Service[onebox-agent]'
,'66.linux.net.Status[eth2]'
,'89.linux.net.Tx_Rate[eth0]'
,'11.UTM.vnet.Rx_Rate[eth3]'
,'11.UTM.vnet.Rx_Rate[eth4]'
,'9.linux.net.Rx_Rate[eth2]'
,'9.linux.process.Process[/usr/sbin/mysqld]'
,'90.UTM.vnet.Tx_Rate[eth0]'
,'8.linux.process.Service[zabbix-agent]'
,'90.UTM.vnet.Tx_Rate[eth1]'
,'66.linux.process.Service[glance-api]'
,'64.UTM.vnet.Rx_Rate[eth1]'
,'net.tcp.service[tcp,,10050]'
,'9.linux.net.Tx_Rate[eth5]'
,'90.UTM.vnet.ConnTrack'
,'66.linux.net.Tx_Rate[eth5]'
,'8.linux.net.Tx_Rate[enp3s0f0]'
,'89.linux.net.Status[eth4]'
,'9.linux.net.Rx_Rate[eth6]'
,'90.UTM.vnet.Tx_Rate[eth4]'
,'66.linux.cpu.Util'
,'9.linux.process.Service[zabbix-agent]'
,'9.linux.net.Rx_Rate[eth3]'
,'66.linux.net.Status[eth0]'
,'9.linux.process.Service[nova-api]'
,'66.linux.net.Status[eth3]'
,'11.UTM.vmem.Util'
,'9.linux.process.Service[onebox-vnfm]'
,'8.linux.process.Service[httpd]'
,'8.linux.temperature.SVR'
,'9.linux.process.Service[glance-api]'
,'9.linux.net.Status[eth1]'
,'9.linux.net.Tx_Rate[eth4]'
,'90.UTM.vnet.Rx_Rate[eth6]'
,'64.UTM.vnet.VPN_ActiveTunnel'
,'9.linux.net.Rx_Rate[eth5]'
,'66.linux.net.Rx_Rate[eth5]'
,'66.linux.fs.Util[/]'
,'66.linux.process.Service[apache2]'
,'8.linux.process.Service[postgresql-9.3]'
,'66.linux.net.Rx_Rate[eth4]'
,'89.linux.fs.Util[/mnt/flash/data]'
,'64.UTM.vnet.Tx_Rate[eth3]'
,'90.UTM.vnet.VPN_TotalTunnel'
,'9.linux.mem.Util'
,'9.linux.cpu.Util'
,'89.linux.net.Rx_Rate[eth6]'
,'9.linux.process.Process[python orchm.py]'
,'11.UTM.vnet.Tx_Rate[eth4]'
,'90.UTM.vmem.Util'
,'64.UTM.vnet.VPNCount'
,'89.linux.net.Status[eth6]'
,'64.UTM.vnet.ConnTrack'
,'89.linux.net.Status[eth5]'
,'icmpping[]'
,'9.linux.process.Service[neutron-server]'
,'9.linux.net.Rx_Rate[eth4]'
,'66.linux.mem.Util'
,'66.linux.net.Tx_Rate[eth0]'
,'8.linux.mem.Util'
,'90.UTM.vnet.VPN_ActiveTunnel'
,'90.UTM.vdisk.Util'
,'66.linux.net.Tx_Rate[eth3]'
,'64.UTM.vmem.Util'
,'89.linux.cpu.Util'
,'90.UTM.daemon.Status[vpn]'
,'9.linux.net.Status[eth2]'
,'64.UTM.vnet.VPN_TotalTunnel'
,'89.linux.net.Status[eth1]'
,'90.UTM.vnet.Rx_Rate[eth2]'
,'9.linux.process.Process[MCSAgent]'
,'64.UTM.vnet.Tx_Rate[eth2]'
,'90.UTM.vnet.Tx_Rate[eth3]'
,'9.linux.temperature.SVR'
,'66.linux.process.Service[zabbix-agent]'
,'item.inact'
,'89.linux.net.Rx_Rate[eth5]'
,'90.UTM.vnet.Rx_Rate[eth3]'
,'9.linux.net.Tx_Rate[eth6]'
,'89.linux.net.Rx_Rate[eth2]'
,'89.linux.net.Rx_Rate[eth4]'
,'9.linux.net.Tx_Rate[eth0]'
,'11.UTM.vnet.Rx_Rate[eth1]'
,'icmpping[]'
,'90.UTM.vnet.Rx_Rate[eth0]'
,'9.linux.net.Rx_Rate[eth0]'
,'66.linux.process.Process[rabbitmq-server]'
,'9.linux.process.Process[ZabbixAPIGateway.jar]'
,'9.linux.fs.Util[/]'
,'89.linux.net.Rx_Rate[eth0]'
,'66.linux.net.Status[eth5]'
,'9.linux.net.Tx_Rate[eth7]'
,'9.linux.net.Status[eth3]'
,'66.linux.net.Status[eth4]'
,'9.linux.process.Process[rabbitmq-server]'
,'89.linux.net.Status[eth0]'
,'66.linux.process.Service[neutron-server]'
,'89.linux.net.Tx_Rate[eth1]'
,'8.linux.process.Service[zabbix-server]'
,'8.linux.net.Rx_Rate[enp3s0f0]'
,'90.UTM.vcpu.Util'
,'66.linux.process.Service[nova-api]'
,'66.linux.net.Rx_Rate[eth2]'
,'9.linux.net.Rx_Rate[eth1]'
,'64.UTM.vnet.Tx_Rate[eth1]'
,'64.UTM.vnet.Rx_Rate[eth2]'
,'66.linux.net.Tx_Rate[eth4]'
,'66.linux.net.Rx_Rate[eth3]'
,'9.linux.net.Tx_Rate[eth3]'
,'89.linux.net.Status[eth2]'
,'9.linux.net.Status[eth6]'
,'89.linux.net.Tx_Rate[eth3]'
,'90.UTM.vnet.VPNCount'
,'90.UTM.vnet.Rx_Rate[eth1]'
,'9.linux.net.Status[eth0]'
,'net.tcp.service[tcp,,10050]'
,'66.linux.process.Service[znmsc]'
,'8.linux.fs.Util[/]'
,'90.UTM.vnet.Rx_Rate[eth4]'
,'9.linux.net.Status[eth7]'
,'89.linux.net.Rx_Rate[eth3]'
,'8.linux.cpu.Util'
,'11.UTM.daemon.Status[vpn]'
,'9.linux.process.Process[tomcat]'
,'90.UTM.vnet.Rx_Rate[eth5]'
,'90.UTM.vnet.Tx_Rate[eth6]'
,'9.linux.net.Tx_Rate[eth1]'
,'89.linux.temperature.SVR'
,'9.linux.net.Status[eth5]'
,'9.linux.net.Tx_Rate[eth2]'
,'90.UTM.vnet.Tx_Rate[eth5]'
,'9.linux.process.Service[onebox-agent]'
,'11.UTM.vnet.Rx_Rate[eth2]'
,'64.UTM.vnet.Rx_Rate[eth3]'
,'90.UTM.vnet.Tx_Rate[eth2]'
,'66.linux.process.Process[/usr/sbin/mysqld]'
,'89.linux.process.Service[zabbix_agentd]'
,'89.linux.net.Status[eth3]'
,'64.UTM.vdisk.Util'
,'64.UTM.license.Status'
,'11.UTM.vdisk.Util'
,'89.linux.net.Tx_Rate[eth2]'
,'89.linux.net.Tx_Rate[eth4]'
,'89.linux.net.Rx_Rate[eth1]'
,'11.UTM.vnet.Tx_Rate[eth3]'
,'9.linux.net.Status[eth4]'
,'9.linux.net.Rx_Rate[eth7]'
,'11.UTM.vnet.Tx_Rate[eth1]'
,'9.linux.process.Service[mysql]'
,'9.linux.process.Service[postgresql]'
,'89.linux.mem.Util'
,'89.linux.process.Service[znmsc]'
,'66.linux.net.Rx_Rate[eth0]'
,'9.linux.process.Service[apache2]'
,'66.linux.process.Service[onebox-vnfm]'
,'11.UTM.vnet.Tx_Rate[eth2]'
,'64.UTM.vcpu.Util'
,'66.linux.net.Tx_Rate[eth2]')		
		) item
WHERE hist.itemid=item.itemid 
AND hist.clock > 1623117660
GROUP BY item.host, item.key_, hist.itemid
) A

--order by key_